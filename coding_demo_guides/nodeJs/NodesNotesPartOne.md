## Node Notes
### Demo: First part before lunch

Status when this party starts: GET endpoint, 200 response with the bible and quran (hardcoded values)  
last commit before we start: 'adds and configures testing frameworks'

- Where we start: want to replicate rails and add ORM, provides a middle layer to the db
- 'active record' for rails, we are going to use sequelize for node
- set up a DB with postgres
- adding the CLI -
```
$ npm i -g sequelize-cli
$ yarn add sequelize pg pg-hstore
```
 
  ```
  $ touch .sequelizerc
  ```
- move in to that file, to tell sequelize what folder stucture we want
- Move into that file and add: 
```
const path = require("path");

module.exports = {
  config: path.resolve("./database/config", "config.json"),
  "models-path": path.resolve("./models"),
  "seeders-path": path.resolve("./database/seeders"),
  "migrations-path": path.resolve("./database/migrations"),
};
```

```
$ sequelize init
```
- result should be that it created database/config/config.js

- you should have two new folders, one called database and one called models
- inside models folder is index.js:
    sets up sequelize and configures the models, autogenerated - dont change! (Thomas thinks so anyway)
- in db folder there is a config, migrations and seeders folder (similar like rails)
- config.js (in the database/config folder), named js but is a json file. (typo from Thomas, maybe, apprently it can be a js file as well):
- go into that file:
  ```
  (before the json object in the config.js(on))
  module.exports = {
    // here is the whole json object
  }
  ```

- In that json object (in database/config/config.js): 
  - remove the production part
  - username: postgres
  - database: books_api_april_development (or what evr you want)
  - dialect: postgres
  - do the same to the test db, so books_api_april_test


- now we need to create the db
- low fruit, head to terminal:
  ```
  $ createdb *name of the database on the config.js* -U postgres
  ```
 *DO IT FOR THE TEST DB AS WELL!*

    ERROR: couldnt connect to database, user postgres do this:
     
      $ createuser --interactive --pwprompt
      $ postgres
      $ *enter*
      $ *enter*
      $ n 
      $ y
      $ n 

      (Still doesnt work?
      
      $ sudo code /etc/postgresql/*tab twice*/pg_*tab once*(hba.config)
     
      OR
      
      $ sudo vim /etc/postgresql/*tab twice*/pg_*tab once*(hba.config)

      press 'a' to insert, 
      - change the local all to md5
      ESC :wq 

      $ sudo service postgresql restart

      Still doesn't work, get out into a separate hangout!)

Back on track:
  ```
  $ sequelize model:generate --name Book --attributes title:string
  ```

- new model created, book.js, migration is created books.js

  ```
  $ sequelize db:migrate
  ```
- should get a similar output as when migratiting in rails


*THOMAS CHECK the deprecation warnings about boolean value with the v5*

  ```
  $ psql -U postgres 
  postgres => \l
  *enter*
  (Should see list of databases) 
  postgres=> \c books_api_april_development
  ("you are now connected to databaseName as user userName")
  books_api_april_development=> \dt
  (should see a list of tables, Books and seqMeta)
  books_api_april_development=>
  ```

- open a new terminal window
```
$ sequelize seed:generate --name Book
```
- new seed file should be created in the seeders folder
- remove the comments in the file and:

```
// seeders/(seedfile)

module.exports = {
  up: async (queryInterface, Sequelize) => {
    await queryInterface.bulkInsert(
      "Books",
      [
        {
          title: "Learn NodeJS with Thomas",
          createdAt: new Date(),
          updatedAt: new Date(),
        },
        {
          title: "Learn Sequelize with Adi",
          createdAt: new Date(),
          updatedAt: new Date(),
        },
      ],
      {}
    );
  },

  down: async (queryInterface, Sequelize) => {
    await queryInterface.bulkDelete("Books", null, {});
  },
};

```
  ```
  $ sequelize db:seed:all
  ```
- should execute the seeds, looks like a migration

- go back to books api terminal where you are connected
  ```
  books_api_april_development=> SELECT * FROM "Books";
  ```
- You should see some books in the db table

**What did you learn??**